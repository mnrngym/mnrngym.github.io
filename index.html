<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>性格診断フォーム</title>
  <style>
    :root{
      --bg:#0b0f14; --panel:#111720; --ink:#ecf1f8; --muted:#9fb1c7; --accent:#5cc8ff;
      --line:#1d2633; --btn:#121a26;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
      line-height:1.6;
    }
    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter:blur(8px);
      background:linear-gradient(180deg,rgba(11,15,20,.9),rgba(11,15,20,.6));
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:980px; margin:0 auto; padding:16px}
    h1{font-size:clamp(28px,6vw,40px); margin:8px 0 4px; font-weight:800}
    p.lead{color:var(--muted); margin:0}
    .card{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:16px;
      padding:16px;
      box-shadow:0 6px 24px rgba(0,0,0,.25);
      margin-top:12px;
    }
    .grid{display:grid; grid-template-columns:1fr; gap:12px}
    @media(min-width:900px){ .grid{grid-template-columns:1fr 1fr} }
    .q{
      padding:12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#0f1621;
    }
    .q h4{margin:0 0 8px; font-size:15px; line-height:1.45}
    select{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #223049;
      background:#0f1621;
      color:var(--ink);
    }
    .actions{display:flex; gap:8px; flex-wrap:wrap}
    button{
      padding:12px 16px;
      border-radius:12px;
      border:1px solid var(--line);
      background:var(--btn);
      color:var(--ink);
      cursor:pointer;
      font-size:16px;
    }
    button.primary{border-color:var(--accent)}
    .note{color:var(--muted); font-size:13px; margin:8px 0 0}
    .notice{color:var(--muted); font-size:13px; margin:12px 0 0; line-height:1.75}
    .notice strong{color:var(--ink)}
    /* thanks view（宗教フォームと同じ挙動） */
    #thanks{display:none; min-height:100vh; background:#fff; color:#111}
    #thanks .center{max-width:680px; margin:0 auto; padding:80px 16px; text-align:center}
    #thanks .box{background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:40px; box-shadow:0 8px 24px rgba(0,0,0,.06)}
    #thanks h1{font-size:28px; margin:0 0 8px}
    #thanks p{margin:4px 0 20px}
    #thanks a{color:#e11d48; text-decoration:none; font-weight:600}
  </style>
</head>
<body>

<header id="siteHeader">
  <div class="wrap">
    <h1><strong>性格診断フォーム</strong></h1>
    <p class="lead">プルダウンで回答して送信してください。</p>
    <p class="lead">
      あなたの日常の傾向から、性格を推定します。<br>
      回答後、一番下の「診断結果送信」を押してください
    </p>
  </div>
</header>

<main class="wrap" id="siteMain">
  <section class="card">
    <div class="grid" id="basicGrid"></div>
    <p class="note">各設問のプルダウンから「はい／どちらでもない／いいえ」を選んでください。</p>
  </section>

  <section class="card">
    <h2 style="margin:0 0 12px; font-size:18px">設問</h2>
    <div id="qgrid" class="grid"></div>
  </section>

  <section class="card">
    <div class="actions">
      <button class="primary" type="button" id="submitBtn">診断結果送信</button>
      <button type="button" onclick="copyAll()">すべてコピーする</button>
    </div>

    <div class="notice">
      <strong>回答ありがとうございました！</strong><br><br>

      一両日中に Line か ご指定のメールアドレスに結果を送信します<br>
      少々お待ちください<br><br>

      ※3日を過ぎて届かない場合は一報ください<br>
      ※メールの方はmnrngym1@gmail.comからのメールを受け取れるようにしてください
    </div>
  </section>
</main>

<!-- Thanks page -->
<div id="thanks">
  <div class="center">
    <div class="box">
      <h1>ありがとうございます！</h1>
      <p>送信が無事に完了しました。</p>
      <p><a id="backLink" href="#">サイトに戻る</a></p>
    </div>
    <p style="margin-top:18px; color:#6b7280; font-size:13px">（静的サイトから送信）</p>
  </div>
</div>

<script>
  // 送信先（Yahoo）
  const MAIL_TO = 'mnrngym@yahoo.co.jp';
  const FORMSUBMIT_ENDPOINT = 'https://formsubmit.co/ajax/' + encodeURIComponent(MAIL_TO);

  // 基本情報（番号なし）
  const basicQuestions = [
    { title:"性別", name:"性別", options:["選択してください","男性","女性","その他"] },
    { title:"年齢", name:"年齢", options:(()=>{const a=["選択してください"];for(let i=1;i<=100;i++)a.push(i+"歳");return a;})() },
    { title:"職業", name:"職業", options:[
      "選択してください","経営者・役員","会社員（総合職）","会社員（一般職）",
      "契約社員・派遣社員","パート・アルバイト","公務員（教職員除く）","教職員",
      "医療関係者","自営業・自由業","専業主婦・主夫","大学生・大学院生",
      "専門学校生・短大生","高校生",
      "士業（公認会計士・弁護士・税理士・司法書士）",
      "無職","定年退職","その他"
    ]}
  ];

  const basicGrid = document.getElementById("basicGrid");
  basicQuestions.forEach(q=>{
    const d=document.createElement("div"); d.className="q";
    d.innerHTML=`<h4>${q.title}</h4>`;
    const s=document.createElement("select"); s.name=q.name;

    q.options.forEach((o,i)=>{
      const op=document.createElement("option");
      if(i===0){
        op.value="";
        op.textContent=o;
      }else{
        // 年齢だけ value は数値、表示は「○歳」
        op.value = (q.name==="年齢") ? o.replace("歳","") : o;
        op.textContent=o;
      }
      s.appendChild(op);
    });

    d.appendChild(s);
    basicGrid.appendChild(d);
  });

  // 設問（文言は一切変更しない / 1〜50）
  const questions=[
    "計画的に物事を進めるのが好きだ","新しいことに挑戦するのが好きだ","人前で話すのが得意だ",
    "一人で過ごす時間が好きだ","感情を表に出すことが多い","細かいことが気になる","周囲の目を気にする",
    "常に何かを学びたいと思っている","決断力がある","時間にルーズな方だ","物事をじっくり考えるタイプだ",
    "社交的である","直感を信じるほうだ","完璧を求めがちだ","人に頼られると嬉しい","落ち込みやすい",
    "誰とでも仲良くなれる","責任感が強い","感情の起伏が激しい","長所より短所に目がいきがちだ",
    "挑戦より安定を好む","相手の立場で物事を考える","周りの人を元気づけることができる",
    "自分の気持ちを素直に伝えるのが得意だ","集中力がある","ストレスを感じやすい","几帳面な性格だ",
    "優柔断だと思う","負けず嫌いな性格だ","ユーモアがあると言われる","リーダーシップがある",
    "コツコツ努力を重ねるタイプだ","自分の世界に没頭しやすい","協調性を大切にする",
    "物事を論理的に考えるタイプだ","話すより聞く方が得意だ","自分を客観的に見られる",
    "好奇心が強い","自分の意見をはっきり言える","変化を楽しめるタイプだ","周囲の空気を読むのが得意だ",
    "感情を抑えることが多い","ミスを引きずることが多い","一度決めたら最後までやり通す",
    "人の影響を受けやすい","誰かのために行動するのが好きだ","自己主張が強い",
    "空想するのが好きだ","過去の出来事を引きずるタイプだ","新しい人間関係を築くのが得意だ"
  ];

  const qgrid=document.getElementById("qgrid");
  questions.forEach((q,i)=>{
    const d=document.createElement("div"); d.className="q";
    d.innerHTML=`<h4>${i+1}. ${q}</h4>
    <select id="q${i+1}">
      <option value="" selected>選択してください</option>
      <option value="はい">はい</option>
      <option value="どちらでもない">どちらでもない</option>
      <option value="いいえ">いいえ</option>
    </select>`;
    qgrid.appendChild(d);
  });

  // Thanks表示
  function showThanks(){
    document.getElementById('siteHeader').style.display='none';
    document.getElementById('siteMain').style.display='none';
    const t = document.getElementById('thanks');
    t.style.display='block';
    document.getElementById('backLink').href = location.origin + location.pathname;
  }

  // 送信ボタン
  document.getElementById('submitBtn').addEventListener('click', async ()=>{
    // 診断（文言は一切変更しない）
    let score = 0;
    for(let i=1;i<=50;i++){
      const v = document.getElementById('q'+i).value;
      if(v==="はい") score += 2;
      else if(v==="どちらでもない") score += 1;
    }
    let result = "";
    if (score >= 80) result = "あなたは外交的でエネルギッシュなタイプです。";
    else if (score >= 60) result = "あなたはバランスのとれた思慮深いタイプです。";
    else result = "あなたは内向的で繊細なタイプです。";

    // 送信本文を作成（質問文は変更しない）
    const lines = [];
    const sex = document.querySelector('select[name="性別"]').value || '';
    const age = document.querySelector('select[name="年齢"]').value || '';
    const job = document.querySelector('select[name="職業"]').value || '';
    lines.push(`性別: ${sex}`);
    lines.push(`年齢: ${age}`);
    lines.push(`職業: ${job}`);
    for(let i=1;i<=50;i++){
      const ans = document.getElementById('q'+i).value || '未回答';
      lines.push(`${i}. ${questions[i-1]} -> ${ans}`);
    }
    lines.push(`診断結果: ${result}`);
    const bodyText = lines.join('\n');

    // 1) FormSubmit /ajax に JSON送信（宗教フォームと同じ）
    let sent = false;
    try{
      const res = await fetch(FORMSUBMIT_ENDPOINT,{
        method:'POST',
        headers:{'Content-Type':'application/json','Accept':'application/json'},
        body: JSON.stringify({
          _subject:'性格診断フォーム 送信',
          message: bodyText
        })
      });
      if(res.ok){ sent = true; }
    }catch(e){ /* フォールバックへ */ }

    // 2) 失敗時は mailto でフォールバック（宗教フォームと同じ）
    if(!sent){
      const subject = encodeURIComponent('性格診断フォーム 送信');
      const body = encodeURIComponent(bodyText + '\n\n(静的サイトから送信)');
      window.location.href = `mailto:${encodeURIComponent(MAIL_TO)}?subject=${subject}&body=${body}`;
    }

    setTimeout(showThanks, 600);
  });

  // 直接 ?thanks=1 で開いた場合もサンクス表示
  if(new URLSearchParams(location.search).get('thanks')==='1'){ showThanks(); }

  // コピー（元の挙動維持）
  function copyAll(){
    const r=document.createRange();
    r.selectNodeContents(document.body);
    const s=window.getSelection();
    s.removeAllRanges(); s.addRange(r);
    document.execCommand("copy");
    alert("ページ全体をコピーしました");
  }
</script>

</body>
</html>
